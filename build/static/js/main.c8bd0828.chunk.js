(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{121:function(e,t,a){},122:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a.n(s),n=a(28),r=a.n(n),l=a(35),i=a(45),o=a(74),d=a(75);const j="SET_MESSAGE",b="CLEAR_MESSAGE";let u;const h=(e,t,a)=>async s=>{u&&clearTimeout(u),u=setTimeout((()=>s((async e=>{e({type:b})}))),1e3*a),s({type:j,data:{message:e,color:t}})};var O=(e={message:"",color:"green"},t)=>{switch(t.type){case j:return t.data;case b:return{message:"",color:"green"};default:return e}},m=a(25),x=a.n(m);const g="/api/blogs";let p=null;var y=async()=>(await x.a.get(g)).data,v=e=>{p="bearer ".concat(e)},w=async e=>{const t={headers:{Authorization:p}};return(await x.a.post(g,e,t)).data},f=async(e,t)=>{const a={headers:{Authorization:p}};return(await x.a.patch("".concat(g,"/").concat(e),t,a)).data},S=async e=>{const t={headers:{Authorization:p}};try{return(await x.a.delete("".concat(g,"/").concat(e),t)).data}catch(a){return console.error(a),a.message}},k=async(e,t)=>(await x.a.post("".concat(g,"/").concat(e,"/comments"),{comment:t})).data;const C="INIT_BLOGS",E="CREATE_BLOG",L="LIKE_BLOG",B="COMMENT_BLOG",T="DELETE_BLOG";var A=(e=[],t)=>{switch(t.type){case C:return t.data;case E:return[...e,t.data];case L:case B:return e.map((e=>e.id===t.data.id?t.data:e));case T:return e.filter((e=>e.id!==t.data.id));default:return e}};var I=async e=>(await x.a.post("/api/login",e)).data;const N="SET_INITIAL",G="LOGIN",_="LOGOUT";var z=(e=null,t)=>{switch(t.type){case N:case G:return t.user;case _:return null;default:return e}};const R=Object(i.combineReducers)({message:O,blogs:A,user:z});var U=Object(i.createStore)(R,Object(o.composeWithDevTools)(Object(i.applyMiddleware)(d.a))),M=a(34),D=a(12),J=a(159),P=a(158),q=a(157),F=a(1);var K=({blog:e,user:t=null,likeBlog:a,deleteBlog:c,addComment:n})=>{var r,l;const[i,o]=Object(s.useState)("");return e?Object(F.jsxs)("div",{className:"blog",children:[Object(F.jsxs)("h2",{children:[e.title," ",e.author]}),Object(F.jsx)(J.a,{href:e.url,rel:"noreferrer",target:"_blank",children:e.url}),Object(F.jsx)("br",{}),e.likes," likes",Object(F.jsx)(P.a,{variant:"outlined",size:"small",sx:{m:"1rem"},className:"like",onClick:()=>a(e.id,e.likes),children:"like"}),Object(F.jsx)("br",{}),(null===e||void 0===e||null===(r=e.user)||void 0===r?void 0:r.name)?"added by ".concat(e.user.name):"",Object(F.jsx)("br",{}),(null===e||void 0===e||null===(l=e.user)||void 0===l?void 0:l.name)===(null===t||void 0===t?void 0:t.name)&&Object(F.jsx)(P.a,{onClick:()=>c(e),children:"remove"}),Object(F.jsx)("h3",{children:"Comments"}),Object(F.jsx)(q.a,{type:"text",value:i,onChange:({target:e})=>o(e.value)}),Object(F.jsx)(P.a,{sx:{m:"1rem"},variant:"contained",size:"large",onClick:()=>{if(!i)return alert("Please enter a valid comment!");n(e.id,i),o("")},children:"add comment"}),e.comments.length?Object(F.jsx)("div",{children:Object(F.jsx)("ul",{children:e.comments.map((e=>Object(F.jsx)("li",{children:e},e)))})}):null]}):null};var V=()=>{const{message:e,color:t}=Object(l.c)((e=>e.message)),a={display:e?"block":"none",background:"lightgray",borderStyle:"solid",borderColor:t,borderRadius:5,borderWidth:3,color:t,fontSize:"1.2em",padding:10};return Object(F.jsx)("p",{style:a,children:e})};const W=c.a.forwardRef(((e,t)=>{const[a,c]=Object(s.useState)(!1),n={display:a?"none":""},r={display:a?"":"none"},l=()=>{c(!a)};return Object(s.useImperativeHandle)(t,(()=>({toggleVisibility:l}))),Object(F.jsxs)("div",{children:[Object(F.jsx)("div",{style:n,children:Object(F.jsx)(P.a,{onClick:l,variant:"contained",children:e.buttonLabel})}),Object(F.jsxs)("div",{style:r,children:[e.children,Object(F.jsx)(P.a,{onClick:l,variant:"outlined",size:"small",children:"cancel"})]})]})}));W.displayName="Togglable";var H=W,Q=a(162);const X="/api/users";var Y=async()=>(await x.a.get(X)).data,Z=async e=>(await x.a.get("".concat(X,"/").concat(e))).data,$=async e=>(await x.a.post(X,e)).data;var ee=({handleSubmit:e})=>{const[t,a]=Object(s.useState)(""),[c,n]=Object(s.useState)(""),[r,l]=Object(s.useState)(""),[i,o]=Object(s.useState)(""),[d,j]=Object(s.useState)(!1),b=async e=>{if(e.preventDefault(),t.length<5||c.length<3||r.length<5||r!==i)return alert("Make sure you fill in the form properly!");try{await $({username:c,password:r,name:t}),l(""),o(""),a(""),j(!d)}catch(s){alert("An error has occured: ".concat(s.message))}};return d?Object(F.jsxs)(Q.a,{children:[Object(F.jsx)("h2",{children:"Sign up"}),Object(F.jsxs)("form",{onSubmit:b,children:[Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{type:"text",label:"First and Last name",value:t,onChange:({target:e})=>a(e.value),name:"name",sx:{mb:"1rem"}})}),Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{id:"username",type:"text",label:"username",value:c,onChange:({target:e})=>n(e.value),name:"Username",sx:{mb:"1rem"}})}),Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{id:"password",type:"password",label:"password",value:r,onChange:({target:e})=>l(e.value),name:"Password",sx:{mb:"1rem"}})}),Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{type:"password",label:"repeat password",value:i,onChange:({target:e})=>o(e.value),name:"Password"})}),Object(F.jsx)(P.a,{sx:{my:"1rem"},variant:"contained",id:"login-button",type:"submit",children:"register"}),Object(F.jsxs)("p",{children:["Already registered? ",Object(F.jsx)(P.a,{onClick:()=>j(!d),children:"Login"})]})]})]}):Object(F.jsxs)(Q.a,{children:[Object(F.jsx)("h2",{children:"Log in"}),Object(F.jsxs)("form",{onSubmit:t=>{t.preventDefault(),e({username:c,password:r}),n(""),l("")},children:[Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{id:"username",type:"text",label:"username",value:c,onChange:({target:e})=>n(e.value),name:"Username",sx:{mb:"1rem"}})}),Object(F.jsx)("div",{children:Object(F.jsx)(q.a,{id:"password",type:"password",label:"password",value:r,onChange:({target:e})=>l(e.value),name:"Password"})}),Object(F.jsx)(P.a,{sx:{my:"1rem"},variant:"contained",id:"login-button",type:"submit",children:"login"}),Object(F.jsxs)("p",{children:["Not yet registered? ",Object(F.jsx)(P.a,{onClick:()=>j(!d),children:"Sign up"})]})]})]})},te=a(163);var ae=({handleSubmit:e})=>{const[t,a]=Object(s.useState)(""),[c,n]=Object(s.useState)(""),[r,l]=Object(s.useState)("");return Object(F.jsxs)("div",{children:[Object(F.jsx)("h2",{children:"Create new"}),Object(F.jsxs)(te.a,{onSubmit:s=>{s.preventDefault(),e({title:t,author:c,url:r}),a(""),n(""),l("")},component:"form",sx:{my:"1rem"},children:[Object(F.jsx)(q.a,{required:!0,label:"Title",id:"title",type:"text",value:t,onChange:({target:e})=>a(e.value),sx:{mr:"1rem"}}),Object(F.jsx)(q.a,{required:!0,id:"author",label:"Author",type:"text",value:c,onChange:({target:e})=>n(e.value),sx:{mr:"1rem"}}),Object(F.jsx)(q.a,{required:!0,label:"URL",type:"url",value:r,onChange:({target:e})=>l(e.value),sx:{mr:"1rem"}}),Object(F.jsx)(P.a,{type:"submit",variant:"contained",size:"large",children:"create"})]})]})},se=a(164),ce=a(161),ne=a(165),re=a(166),le=a(167),ie=a(168),oe=a(169);var de=()=>{const[e,t]=Object(s.useState)([]);return Object(s.useEffect)((()=>{Y().then((e=>{t(e)}))}),[]),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("h2",{children:"Users"}),Object(F.jsx)(se.a,{component:ce.a,children:Object(F.jsxs)(ne.a,{children:[Object(F.jsx)(re.a,{children:Object(F.jsxs)(le.a,{children:[Object(F.jsx)(ie.a,{children:"Name"}),Object(F.jsx)(ie.a,{children:"blogs created"})]})}),Object(F.jsx)(oe.a,{children:e.map((e=>Object(F.jsxs)(le.a,{children:[Object(F.jsx)(ie.a,{children:Object(F.jsx)(J.a,{component:M.b,to:"/users/".concat(e.id),children:e.name})}),Object(F.jsx)(ie.a,{children:e.blogs.length})]},e.id)))})]})})]})};var je=()=>{const{id:e}=Object(D.f)(),[t,a]=Object(s.useState)(null);return Object(s.useEffect)((()=>{Z(e).then((e=>{a(e)}))}),[]),t?Object(F.jsxs)("div",{children:[Object(F.jsx)("h2",{children:t.name}),Object(F.jsx)("h3",{children:"added blogs"}),Object(F.jsx)("ul",{children:t.blogs.map((e=>Object(F.jsx)("li",{children:e.title},e.id)))})]}):null},be=(a(121),a(170)),ue=a(171);var he=()=>{const e=Object(s.useRef)(),t=Object(l.c)((e=>e.blogs)),a=Object(l.c)((e=>e.user)),c=Object(l.b)();Object(s.useEffect)((()=>{c((async e=>{const t=await y();t.sort(((e,t)=>t.likes-e.likes)),e({type:C,data:t})})),c((async e=>{const t=window.localStorage.getItem("loggedBloglistUser");if(t){const a=JSON.parse(t);v(a.token),e({type:N,user:a})}}))}),[c]);const n=async({username:e,password:t})=>{try{await c((a={username:e,password:t},async e=>{const t=await I(a);t&&(window.localStorage.setItem("loggedBloglistUser",JSON.stringify(t)),v(t.token),e({type:G,user:t}))})),c(h("login successful","green",4))}catch(s){c(h("wrong username or password","red",4))}var a},r=async({title:t,author:a,url:s})=>{try{await c((({title:e,author:t,url:a})=>async s=>{const c=await w({title:e,author:t,url:a});s({type:E,data:c})})({title:t,author:a,url:s})),e.current.toggleVisibility(),c(h("a new blog ".concat(t," by ").concat(a," added"),"green",4))}catch(n){c(h(n.message,"red",4))}},i=Object(D.g)("/blogs/:id"),o=i?t.find((e=>e.id===i.params.id)):null;return null===a?Object(F.jsxs)(Q.a,{children:[Object(F.jsx)(V,{}),Object(F.jsx)(ee,{handleSubmit:n})]}):Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(be.a,{position:"static",children:Object(F.jsxs)(ue.a,{children:[Object(F.jsx)(P.a,{color:"inherit",component:M.b,to:"/",children:"blogs"}),Object(F.jsx)(P.a,{color:"inherit",component:M.b,to:"/users",children:"users"}),Object(F.jsxs)("span",{children:[a.name," logged in "]}),Object(F.jsx)(P.a,{color:"inherit",onClick:()=>{c((async e=>{window.localStorage.removeItem("loggedBloglistUser"),e({type:_})})),c(h("logout successful","green",4))},children:"Logout"})]})}),Object(F.jsxs)(Q.a,{children:[Object(F.jsx)("h2",{children:"blog app"}),Object(F.jsx)(V,{}),Object(F.jsxs)(D.c,{children:[Object(F.jsx)(D.a,{path:"/users/:id",children:Object(F.jsx)(je,{})}),Object(F.jsx)(D.a,{path:"/users",children:Object(F.jsx)(de,{})}),Object(F.jsx)(D.a,{path:"/blogs/:id",children:Object(F.jsx)(K,{blog:o,user:a,likeBlog:async(e,t)=>{try{await c(((e,t)=>async a=>{const s=await f(e,{likes:t+1});a({type:L,data:s})})(e,t)),c(h("blog with id=".concat(e," has just been liked"),"green",4))}catch(a){c(h(a.message,"red",4))}},deleteBlog:async e=>{if(window.confirm("Remove blog ".concat(e.title," by ").concat(e.author,"?")))try{await c((t=e.id,async e=>{await S(t),e({type:T,data:{id:t}})})),c(h("blog: ".concat(e.title," has just been deleted"),"green",4))}catch(a){c(h(a.message,"red",4))}var t},addComment:(e,t)=>{c(((e,t)=>async a=>{const s=await k(e,t);a({type:B,data:s})})(e,t))}})}),Object(F.jsxs)(D.a,{path:"/",children:[Object(F.jsx)(H,{buttonLabel:"create new blog",ref:e,children:Object(F.jsx)(ae,{handleSubmit:r})}),Object(F.jsxs)(ne.a,{children:[Object(F.jsx)(re.a,{children:Object(F.jsxs)(le.a,{children:[Object(F.jsx)(ie.a,{children:"Title"}),Object(F.jsx)(ie.a,{children:"Author"})]})}),Object(F.jsx)(oe.a,{children:t.map((e=>Object(F.jsxs)(le.a,{children:[Object(F.jsx)(ie.a,{children:Object(F.jsx)(J.a,{component:M.b,to:"/blogs/".concat(e.id),children:e.title})}),Object(F.jsxs)(ie.a,{children:[" ",e.author]})]},e.id)))})]})]})]}),Object(F.jsx)("p",{children:"Copyright \xa9 2021 Botond Kulcs\xe1r"})]})]})};r.a.render(Object(F.jsx)(l.a,{store:U,children:Object(F.jsx)(M.a,{children:Object(F.jsx)(he,{})})}),document.getElementById("root"))}},[[122,1,2]]]);
//# sourceMappingURL=main.c8bd0828.chunk.js.map